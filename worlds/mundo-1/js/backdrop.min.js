(function() {
   function inicio() {
      document.querySelectorAll('.js-lanzadorRedi__boton').forEach(btn => 
         btn.addEventListener('click', abrirREDI));
      animatedBanners();
   }

   function escucharTecladoCerrarTema() {
      document.addEventListener("keydown", (e) => {
         if (e.keyCode === 27) {
            console.log("cerrando backdrop");
            const backdropRedi = document.querySelector(".backdrop.redi-activo");
            if (backdropRedi) {
               backdropRedi.classList.add("redi-inactivo");
               backdropRedi.classList.remove("redi-activo");
               document.querySelector(".tema").style.overflow = "";
            } else {
               const backdropTema = document.querySelector(".backdrop.tema-activo");
               backdropTema.classList.add("tema-inactivo");
               backdropTema.classList.remove("tema-activo");
               document.body.style.overflow = "";
            }
         }
      });
   }

   function abrirREDI(event) {
      abrirPrecarga();
      event.preventDefault();

      const url = this.getAttribute('data-target');
      document.querySelector('.js-backdrop__iframe').src = url;

      const tipoRedi = this.getAttribute("data-tipo-redi");
      const precarga = document.querySelector('.js-backdrop__precarga');
      precarga.classList.remove("entrenamiento", "exploracion");
      precarga.classList.add(tipoRedi);

      document.body.style.overflow = 'hidden';
      const redi = document.querySelector(".js-redi");
      redi.classList.remove("redi-inactivo");
      redi.classList.add("redi-activo");
      document.querySelector(".tema").style.overflow = "hidden";

      const cerrarBtn = redi.querySelector(".cerrar a");
      cerrarBtn.addEventListener("click", () => {
         console.log("cerrando");
         redi.classList.add("redi-inactivo");
         redi.classList.remove("redi-activo");
         document.querySelector(".tema").style.overflow = "";
      });
   }

   function abrirPrecarga() {
      console.log('abriendo la precarga y el REDI');
      document.querySelector('.js-backdrop__precarga')
         .classList.remove('backdrop__precarga--invisible');
   }

   window.addEventListener('message', function(event) {
      if (event.data.hasOwnProperty("cerrarRedi")) {
         console.log('recibe el evento de cerrar el REDI');
         const redi = document.querySelector(".redi");
         if (redi.classList.contains("redi-activo")) {
            redi.classList.add("redi-inactivo");
            redi.classList.remove("redi-activo");
            document.querySelector(".tema").style.overflow = "";
         }
      }
      if (event.data.hasOwnProperty("cerrarPrecarga")) {
         console.log('recibe el evento de cerrar la precarga en la leccion');
         document.querySelector('.js-backdrop__precarga')
            .classList.add('backdrop__precarga--invisible');
      }
   });

   function animatedBanners() {
      const idBackground1 = document.getElementById("superServidor__fondoEscenario1");
      const idBackground2 = document.getElementById("superServidor__fondoEscenario2");
      const idHero = document.getElementById("superServidor__personaje");

      setTimeout(() => {
         idBackground1.classList.add("superServidor__fondoEscenario--ocultar");
         idBackground2.classList.add("superServidor__fondoEscenario--mostrar");
         idHero.classList.add("superServidor__personaje--cambio");
      }, 2000);
   }

   document.addEventListener("DOMContentLoaded", inicio);
})();